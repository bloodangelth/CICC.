<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CICC Chatbot</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        /* --- CSS ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏†‡∏≤‡∏©‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏î‡∏≤‡∏ß --- */
        :root {
            --primary-color: #bb0d0d;
            --bg-color: #f4f4f9;
            --chat-bg: #ffffff;
            --user-msg-bg: #0056b3;
            --bot-msg-bg: #e9ecef;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Sarabun', sans-serif; }
        body { background-color: var(--bg-color); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* Notification Bar */
        .notification-bar {
            background-color: #ff9800; color: white; padding: 8px 15px; font-size: 0.9rem;
            display: none; align-items: center; justify-content: space-between;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); z-index: 20; animation: slideDown 0.3s ease-out;
        }
        .notif-content { display: flex; align-items: center; gap: 10px; overflow: hidden; flex: 1; }
        .notif-content i { flex-shrink: 0; }
        .marquee-wrapper { overflow: hidden; white-space: nowrap; width: 100%; }
        .marquee-text { display: inline-block; padding-left: 100%; animation: marquee 15s linear infinite; }
        @keyframes marquee { 0% { transform: translate(0, 0); } 100% { transform: translate(-100%, 0); } }
        @keyframes slideDown { from { transform: translateY(-100%); } to { transform: translateY(0); } }
        .notif-close { background: none; border: none; color: rgba(255,255,255,0.8); font-size: 1.2rem; cursor: pointer; padding: 0 0 0 10px; }

        /* Header */
        .chatbot-container { width: 100%; height: 100%; display: flex; flex-direction: column; max-width: 600px; margin: 0 auto; background: var(--chat-bg); box-shadow: 0 0 20px rgba(0,0,0,0.1); }
        .chatbot-header { background: var(--primary-color); color: white; padding: 15px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 5px rgba(209, 18, 18, 0.1); z-index: 10; }
        .header-content { display: flex; align-items: center; gap: 15px; }
        .logo { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; background: white; padding: 2px; }
        .title-group h3 { font-size: 1.2rem; margin-bottom: 2px; }
        .title-group p { font-size: 0.85rem; opacity: 0.9; }
        .admin-link { color: rgba(255,255,255,0.8); text-decoration: none; font-size: 1.2rem; transition: 0.2s; padding: 5px; }
        .admin-link:hover { color: white; transform: rotate(45deg); }

        /* Chat Area */
        .chat-area { flex: 1; padding: 20px; padding-bottom: 10px; overflow-y: auto; background: #fff; scroll-behavior: smooth; }
        .message-group { display: flex; gap: 10px; margin-bottom: 20px; align-items: flex-start; }
        .message-group.user { flex-direction: row-reverse; }
        .avatar { width: 40px; height: 40px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; border-radius: 50%; overflow: hidden; background-color: #eee; }
        .avatar img { width: 100%; height: 100%; object-fit: cover; }
        .avatar-icon { font-size: 24px; }
        .message { max-width: 80%; padding: 12px 16px; border-radius: 18px; font-size: 1rem; line-height: 1.5; word-wrap: break-word; box-shadow: 0 1px 2px rgba(0,0,0,0.1); position: relative; }
        .bot-message { background-color: var(--bot-msg-bg); color: #333; border-top-left-radius: 4px; }
        .user-message { background-color: var(--user-msg-bg); color: white; border-top-right-radius: 4px; }

        /* Quick Menu */
        .quick-menu-bar { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 10px; white-space: nowrap; scrollbar-width: none; }
        .quick-menu-bar::-webkit-scrollbar { display: none; }
        .quick-btn { background-color: white; border: 1px solid var(--primary-color); color: var(--primary-color); padding: 6px 14px; border-radius: 20px; cursor: pointer; font-size: 0.85rem; font-weight: 500; transition: all 0.2s ease; display: flex; align-items: center; gap: 6px; flex-shrink: 0; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .quick-btn:hover { background-color: var(--primary-color); color: white; transform: translateY(-2px); }
        .quick-btn i { font-size: 1rem; }

        /* TTS Button */
        .tts-btn { background: transparent; border: 1px solid #ccc; color: #666; margin-top: 8px; padding: 4px 10px; font-size: 0.75rem; border-radius: 12px; cursor: pointer; display: inline-flex; align-items: center; gap: 5px; transition: 0.2s; }
        .tts-btn:hover { background: #ddd; color: #333; }

        /* Input Area */
        .chat-input-area { padding: 10px 15px 15px 15px; background: white; border-top: 1px solid #eee; display: flex; flex-direction: column; }
        .chat-input-wrapper { display: flex; gap: 10px; align-items: flex-end; background: #f8f9fa; padding: 8px; border-radius: 25px; border: 1px solid #ddd; }
        textarea { flex: 1; border: none; background: transparent; padding: 10px; font-size: 16px; resize: none; max-height: 120px; outline: none; }
        #sendBtn { background: var(--primary-color); color: white; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; flex-shrink: 0; margin-bottom: 2px; }
        #sendBtn:hover { opacity: 0.9; transform: scale(1.05); }
        .disclaimer { font-size: 0.75rem; color: #888; text-align: center; margin-top: 8px; }
    </style>
</head>

<body>
    <div class="chatbot-container">
        
        <div id="notificationBar" class="notification-bar">
            <div class="notif-content">
                <i class="fas fa-bullhorn"></i>
                <div class="marquee-wrapper">
                    <span class="marquee-text" id="notifText">‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®: ...</span>
                </div>
            </div>
            <button class="notif-close" onclick="closeNotification()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <header class="chatbot-header">
            <div class="header-content">
                <img src="cicc.png" class="logo" alt="CICC Logo">
                <div class="title-group">
                    <h3>CICC Chatbot</h3>
                    <p>‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå ‚Ä¢ AI Model CICC</p>
                </div>
            </div>
            <a href="admin.html" class="admin-link" title="‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö (Admin)">
                <i class="fas fa-cog"></i>
            </a>
        </header>

        <div class="chat-area" id="chatArea">
            <div class="message-group bot">
                <div class="avatar">
                    <img src="cicc.png" alt="Bot">
                </div>
                <div class="message bot-message">
                    <p>‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏ú‡∏°‡∏Ñ‡∏∑‡∏≠ CICC Chatbot ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏±‡∏ö</p>
                    <p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ñ‡∏≤‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö üëá</p>
                    
                    <button class="tts-btn" onclick="playFinalVoice('‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö ‡∏ú‡∏°‡∏Ñ‡∏∑‡∏≠ CICC Chatbot ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏±‡∏ö ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ñ‡∏≤‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö')">
                        <i class="fas fa-volume-up"></i> ‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á
                    </button>
                </div>
            </div>
        </div>

        <div class="chat-input-area">
            <div class="quick-menu-bar" id="quickMenuBar"></div>
            <div class="chat-input-wrapper">
                <textarea id="userInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°..." rows="1"></textarea>
                <button id="sendBtn"><i class="fas fa-paper-plane"></i></button>
            </div>
            <p class="disclaimer">‚ö† ‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏•‡∏≤‡∏î‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</p>
        </div>
    </div>

<script>
let appendMessage, getBotResponse, playFinalVoice;
let currentAudio = null;

function recordVisit() {
    const STORAGE_KEY = 'cicc_visit_logs';
    let logs = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
    logs.push(new Date().toISOString());
    localStorage.setItem(STORAGE_KEY, JSON.stringify(logs));
}

function loadNotification() {
    const NOTIF_KEY = 'cicc_notification';
    const notifData = JSON.parse(localStorage.getItem(NOTIF_KEY) || '{"active": false, "message": ""}');
    const bar = document.getElementById('notificationBar');
    const text = document.getElementById('notifText');
    if (notifData.active && notifData.message) {
        text.textContent = notifData.message;
        bar.style.display = 'flex';
    } else {
        bar.style.display = 'none';
    }
}

function closeNotification() {
    document.getElementById('notificationBar').style.display = 'none';
}

function renderQuickButtons() {
    const bar = document.getElementById('quickMenuBar');
    const defaultBtns = [
        { label: "‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏Å‡∏≤‡∏£", icon: "far fa-clock", message: "‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏Å‡∏≤‡∏£" },
        { label: "‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠", icon: "fas fa-phone-alt", message: "‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠" },
        { label: "‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏Å", icon: "fas fa-book-open", message: "‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏Å" }
    ];
    const buttons = JSON.parse(localStorage.getItem('cicc_quick_btns') || JSON.stringify(defaultBtns));
    bar.innerHTML = '';
    buttons.forEach(btn => {
        const button = document.createElement('button');
        button.className = 'quick-btn';
        button.onclick = () => sendQuickMessage(btn.message);
        button.innerHTML = `<i class="${btn.icon}"></i> ${btn.label}`;
        bar.appendChild(button);
    });
}

document.addEventListener('DOMContentLoaded', () => {
    recordVisit();
    renderQuickButtons();
    loadNotification();

    const chatArea = document.getElementById('chatArea');
    const userInput = document.getElementById('userInput');
    const sendBtn = document.getElementById('sendBtn');

    const defaultBotData = [
        { keywords: ["‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ", "‡∏´‡∏ß‡∏±‡∏î‡∏î‡∏µ"], response: "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏°‡∏µ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö?" },
        { keywords: ["‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏Å‡∏≤‡∏£"], response: "üïí <b>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏Å‡∏≤‡∏£:</b><br>‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå ‚Äì ‡∏®‡∏∏‡∏Å‡∏£‡πå<br>08.30 ‚Äì 16.30 ‡∏ô." },
        { keywords: ["‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠"], response: "üìû <b>‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠:</b><br>‡πÇ‡∏ó‡∏£: 064 565 3117" }
    ];

    function loadBotData() {
        const stored = localStorage.getItem('cicc_bot_data');
        return stored ? JSON.parse(stored) : defaultBotData;
    }

    playFinalVoice = function(text) {
        if (currentAudio) { currentAudio.pause(); currentAudio = null; }
        if ('speechSynthesis' in window) { window.speechSynthesis.cancel(); }
        let cleanText = text.replace(/<[^>]*>/g, ' ').replace(/&nbsp;/g, ' ').trim();
        if(!cleanText) return;
        playGoogleQueue(cleanText);
    }

    function playGoogleQueue(text) {
        const MAX_LEN = 100; let sentences = [];
        while (text.length > 0) {
            let chunk = text.substring(0, MAX_LEN);
            let lastSpace = chunk.lastIndexOf(' ');
            if (lastSpace > 0 && text.length > MAX_LEN) chunk = chunk.substring(0, lastSpace);
            sentences.push(chunk); text = text.substring(chunk.length).trim();
        }
        let index = 0;
        function playNextChunk() {
            if (index >= sentences.length) return; 
            let chunk = sentences[index];
            let url = `https://translate.google.com/translate_tts?ie=UTF-8&q=${encodeURIComponent(chunk)}&tl=th&client=tw-ob`;
            let audio = new Audio(url); currentAudio = audio; 
            audio.onended = function() { index++; playNextChunk(); };
            audio.onerror = function() { playNativeFallback(sentences.slice(index).join(" ")); };
            let playPromise = audio.play();
            if (playPromise !== undefined) { playPromise.catch(error => { playNativeFallback(sentences.slice(index).join(" ")); }); }
        }
        playNextChunk();
    }

    function playNativeFallback(text) {
        if (!('speechSynthesis' in window)) return;
        window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'th-TH'; utterance.rate = 1.0;
        let voices = window.speechSynthesis.getVoices();
        let thaiVoice = voices.find(v => v.lang.includes('th'));
        if (thaiVoice) utterance.voice = thaiVoice;
        window.speechSynthesis.speak(utterance);
    }

    appendMessage = function(sender, text) {
        const messageGroup = document.createElement('div');
        messageGroup.classList.add('message-group', sender);
        const avatarDiv = document.createElement('div'); avatarDiv.classList.add('avatar');
        if (sender === 'user') {
            const iconSpan = document.createElement('span'); iconSpan.classList.add('avatar-icon'); iconSpan.textContent = 'üë§'; avatarDiv.appendChild(iconSpan);
        } else {
            const img = document.createElement('img'); img.src = 'cicc.png'; img.alt = 'CICC Bot'; avatarDiv.appendChild(img);
        }
        const messageDiv = document.createElement('div'); messageDiv.classList.add('message', `${sender}-message`);
        messageDiv.innerHTML = `<p>${text.replace(/\n/g, '<br>')}</p>`;
        if (sender === 'bot') {
            const ttsButton = document.createElement('button'); ttsButton.className = 'tts-btn';
            ttsButton.innerHTML = '<i class="fas fa-volume-up"></i> ‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á';
            ttsButton.onclick = function() { playFinalVoice(text); };
            messageDiv.appendChild(ttsButton);
        }
        messageGroup.appendChild(avatarDiv); messageGroup.appendChild(messageDiv);
        chatArea.appendChild(messageGroup); chatArea.scrollTop = chatArea.scrollHeight;
    }

    getBotResponse = function(text) {
        const msg = text.toLowerCase().trim();
        const botData = loadBotData();
        for (let item of botData) {
            for (let keyword of item.keywords) {
                if (msg.includes(keyword.toLowerCase())) return item.response;
            }
        }
        return "‡∏Ç‡∏≠‡πÇ‡∏ó‡∏©‡∏Ñ‡∏£‡∏±‡∏ö ‡∏ú‡∏°‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ô‡∏µ‡πâ \n‡∏•‡∏≠‡∏á‡∏ñ‡∏≤‡∏°‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡πÄ‡∏ä‡πà‡∏ô '‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏Å‡∏≤‡∏£' ‡∏´‡∏£‡∏∑‡∏≠ '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠' ‡∏î‡∏π‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö";
    }

    window.processUserMessage = function(text) {
        if (!text) return;
        appendMessage("user", text);
        setTimeout(() => { appendMessage("bot", getBotResponse(text)); }, 500);
    }

    function sendMessage() {
        const text = userInput.value.trim();
        if (!text) return;
        userInput.value = ""; adjustTextareaHeight(); processUserMessage(text);
    }

    sendBtn.addEventListener("click", sendMessage);
    userInput.addEventListener("keydown", (e) => { if (e.key === "Enter" && !e.shiftKey) { e.preventDefault(); sendMessage(); } });
    function adjustTextareaHeight() {
        userInput.style.height = "auto"; userInput.style.height = userInput.scrollHeight + "px";
        if(userInput.value === '') userInput.style.height = 'auto';
    }
    userInput.addEventListener("input", adjustTextareaHeight);
});

function sendQuickMessage(text) {
    if (window.processUserMessage) window.processUserMessage(text);
}
</script>

</body>
</html>
