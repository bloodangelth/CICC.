<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CICC Admin Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root { --primary-color: #bb0d0d; --bg-color: #f4f4f9; }
        body { font-family: 'Sarabun', sans-serif; background: var(--bg-color); padding: 20px; margin: 0; }
        
        /* Login Overlay */
        #loginOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 999;
            display: flex; justify-content: center; align-items: center;
        }
        .login-box {
            background: white; padding: 30px; border-radius: 10px;
            width: 300px; text-align: center;
            box-shadow: 0 0 20px rgba(255,255,255,0.2);
        }

        /* Container */
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); display: none; }
        
        h2 { color: var(--primary-color); border-bottom: 2px solid #eee; padding-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .back-btn { font-size: 0.9rem; text-decoration: none; color: #666; background: #eee; padding: 5px 10px; border-radius: 5px; }

        /* Stats & Chart */
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 25px; }
        .stat-card { background: #fff; border: 1px solid #eee; padding: 15px; border-radius: 8px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .stat-card .number { font-size: 1.5rem; font-weight: bold; color: var(--primary-color); margin-top: 5px; }
        
        .chart-section { background: #fff; border: 1px solid #eee; padding: 15px; border-radius: 8px; margin-bottom: 30px; }
        .chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .chart-toggles button { background: none; border: 1px solid #ddd; padding: 5px 10px; cursor: pointer; font-size: 0.8rem; }
        .chart-toggles button.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }
        .chart-toggles button:first-child { border-radius: 4px 0 0 4px; }
        .chart-toggles button:last-child { border-radius: 0 4px 4px 0; }

        /* Form & Table */
        .section-header { margin-top: 30px; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #eee; color: var(--primary-color); display: flex; align-items: center; gap: 10px; }
        .form-group { margin-bottom: 15px; }
        input, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        button { cursor: pointer; padding: 10px 20px; border: none; border-radius: 6px; transition: 0.2s; }
        .btn-save { background: var(--primary-color); color: white; width: 100%; }
        .btn-save.editing { background: #ff9800; }
        .keyword-tag { background: #e3f2fd; color: #0d47a1; padding: 2px 6px; border-radius: 4px; margin-right: 4px; display: inline-block; }
        .btn-cancel { background: #999; color: white; width: 100%; margin-top: 5px; display: none; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 0.9rem; }
        th, td { text-align: left; padding: 10px; border-bottom: 1px solid #ddd; }
        th { background: #f8f9fa; }
        .actions { text-align: right; white-space: nowrap; }
        .btn-edit { background: #ffc107; padding: 5px 8px; border-radius: 4px; color: #333; }
        .btn-delete { background: #ff4d4d; color: white; padding: 5px 8px; border-radius: 4px; }

        /* Quick Menu Option Box */
        .quick-option-box {
            background: #fdf2f2; border: 1px dashed var(--primary-color); padding: 15px; border-radius: 8px; margin-bottom: 15px; display: none;
        }
        .quick-option-box.show { display: block; }
        .checkbox-wrapper { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; font-weight: bold; color: var(--primary-color); cursor: pointer; }
        .checkbox-wrapper input { width: auto; margin: 0; }

        /* Icon Picker Style */
        .icon-input-wrapper { display: flex; gap: 10px; align-items: center; }
        .icon-preview { 
            width: 40px; height: 40px; background: white; border: 1px solid #ddd; border-radius: 6px; 
            display: flex; align-items: center; justify-content: center; font-size: 1.2rem; color: var(--primary-color);
            flex-shrink: 0;
        }
        .suggested-icons { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; }
        .icon-chip {
            background: #fff; border: 1px solid #ddd; border-radius: 4px; padding: 5px 10px; 
            cursor: pointer; font-size: 1rem; color: #555; transition: 0.2s; display: flex; align-items: center; gap: 5px;
        }
        .icon-chip:hover { background: var(--primary-color); color: white; border-color: var(--primary-color); }
        .icon-chip span { font-size: 0.75rem; }

        /* Notification Section Style (NEW) */
        .notif-box {
            background: #fff3cd; border: 1px solid #ffeeba; padding: 20px; border-radius: 8px;
            display: flex; flex-direction: column; gap: 15px;
        }
        .switch {
            position: relative; display: inline-block; width: 50px; height: 26px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ccc; transition: .4s; border-radius: 34px;
        }
        .slider:before {
            position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 4px;
            background-color: white; transition: .4s; border-radius: 50%;
        }
        input:checked + .slider { background-color: #28a745; } /* Green */
        input:checked + .slider:before { transform: translateX(24px); }
        .switch-label { display: flex; align-items: center; gap: 10px; font-weight: bold; }

        @media (max-width: 600px) { .stats-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div id="loginOverlay">
    <div class="login-box">
        <h3><i class="fas fa-lock"></i> Admin Login</h3>
        <input type="password" id="adminPassword" placeholder="‡∏£‡∏´‡∏±‡∏™: 1234" style="width:100%; margin-bottom:10px; padding:10px;" onkeydown="if(event.key==='Enter') checkPassword()">
        <button class="btn-save" onclick="checkPassword()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>
</div>

<div class="container" id="mainContainer">
    <h2>
        <span><i class="fas fa-chart-line"></i> ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î & ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span>
        <a href="index.html" class="back-btn"><i class="fas fa-arrow-left"></i> ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ä‡∏ó</a>
    </h2>

    <div class="stats-grid">
        <div class="stat-card">
            <h4><i class="fas fa-calendar-day"></i> ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h4>
            <div class="number" id="statToday">0</div>
        </div>
        <div class="stat-card">
            <h4><i class="fas fa-calendar-alt"></i> ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</h4>
            <div class="number" id="statMonth">0</div>
        </div>
        <div class="stat-card">
            <h4><i class="fas fa-users"></i> ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h4>
            <div class="number" id="statTotal">0</div>
        </div>
    </div>

    <div class="chart-section">
        <div class="chart-header">
            <h4 id="chartTitle" style="margin:0">‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</h4>
            <div class="chart-toggles">
                <button id="btnDaily" class="active" onclick="updateChart('daily')">‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</button>
                <button id="btnMonthly" onclick="updateChart('monthly')">‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>
            </div>
        </div>
        <canvas id="usageChart" height="100"></canvas>
    </div>

    <h3 class="section-header"><i class="fas fa-bullhorn"></i> ‡πÅ‡∏ñ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° (Notification)</h3>
    <div class="notif-box">
        <div class="switch-label">
            <label class="switch">
                <input type="checkbox" id="notifActive">
                <span class="slider"></span>
            </label>
            <span id="notifStatusText">‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>
        </div>
        <div class="form-group" style="margin-bottom:0">
            <label>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:</label>
            <input type="text" id="notifMessage" placeholder="‡πÄ‡∏ä‡πà‡∏ô üì¢ ‡∏ß‡∏±‡∏ô‡∏®‡∏∏‡∏Å‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° Open House ‡∏á‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô">
        </div>
        <button class="btn-save" onclick="saveNotification()"><i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</button>
    </div>


    <h3 class="section-header"><i class="fas fa-robot"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö & ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π</h3>
    
    <div class="form-group">
        <input type="text" id="keywordsInput" placeholder="‡∏Ñ‡∏≥‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå (‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≥) ‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, ‡∏´‡∏ß‡∏±‡∏î‡∏î‡∏µ">
    </div>
    
    <div class="form-group">
        <textarea id="responseInput" placeholder="‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏ö‡∏≠‡∏ó..." style="height:80px"></textarea>
    </div>

    <label class="checkbox-wrapper">
        <input type="checkbox" id="addToQuickCheck" onchange="toggleQuickOption()"> 
        <span><i class="fas fa-plus-square"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π‡∏•‡∏±‡∏î‡∏î‡πâ‡∏ß‡∏¢ (Quick Menu)</span>
    </label>

    <div id="quickOptionBox" class="quick-option-box">
        <div class="form-group">
            <label style="font-size:0.9rem;">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏ô‡∏õ‡∏∏‡πà‡∏°:</label>
            <input type="text" id="quickLabelInput" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏Å‡∏≤‡∏£">
        </div>
        <div class="form-group">
            <label style="font-size:0.9rem;">‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô:</label>
            <div class="icon-input-wrapper">
                <input type="text" id="quickIconInput" placeholder="‡πÄ‡∏ä‡πà‡∏ô far fa-clock" value="fas fa-comment-dots" oninput="updateIconPreview()">
                <div id="iconPreview" class="icon-preview"><i class="fas fa-comment-dots"></i></div>
            </div>
            <div class="suggested-icons" id="suggestedIcons"></div>
        </div>
    </div>

    <button class="btn-save" id="saveBtn" onclick="saveResponse()"><i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    <button class="btn-cancel" id="cancelBtn" onclick="cancelEdit()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>

    <h4 style="margin-top:20px; color:#666;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h4>
    <table>
        <thead><tr><th width="30%">‡∏Ñ‡∏≥‡∏´‡∏•‡∏±‡∏Å</th><th width="50%">‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</th><th width="20%">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
        <tbody id="responseTable"></tbody>
    </table>

    <h3 class="section-header"><i class="fas fa-th-large"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π‡∏•‡∏±‡∏î (Quick Menu)</h3>
    <table>
        <thead><tr><th width="10%">‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô</th><th width="30%">‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏∏‡πà‡∏°</th><th width="40%">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á</th><th width="20%">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
        <tbody id="quickTable"></tbody>
    </table>

</div>

<script>
    const ADMIN_PASS = "1234"; 
    const LOG_KEY = 'cicc_visit_logs';
    const QUICK_KEY = 'cicc_quick_btns';
    const NOTIF_KEY = 'cicc_notification'; // Key ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô

    let editIndex = -1;
    let myChart = null;

    // --- Login ---
    function checkPassword() {
        if(document.getElementById('adminPassword').value === ADMIN_PASS) {
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('mainContainer').style.display = 'block';
            loadStats();
            renderTable();
            renderQuickTable();
            renderSuggestedIcons();
            loadNotification(); // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        } else alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î!");
    }

    // --- Notification Logic (NEW) ---
    function loadNotification() {
        const notifData = JSON.parse(localStorage.getItem(NOTIF_KEY) || '{"active": false, "message": ""}');
        document.getElementById('notifActive').checked = notifData.active;
        document.getElementById('notifMessage').value = notifData.message;
        updateNotifStatusText();
    }

    function saveNotification() {
        const isActive = document.getElementById('notifActive').checked;
        const message = document.getElementById('notifMessage').value.trim();
        
        if (isActive && !message) {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô");
            return;
        }

        const data = { active: isActive, message: message };
        localStorage.setItem(NOTIF_KEY, JSON.stringify(data));
        alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
        updateNotifStatusText();
    }

    document.getElementById('notifActive').addEventListener('change', updateNotifStatusText);

    function updateNotifStatusText() {
        const isActive = document.getElementById('notifActive').checked;
        const textSpan = document.getElementById('notifStatusText');
        if(isActive) {
            textSpan.innerText = "‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ä‡∏ó)";
            textSpan.style.color = "#28a745";
        } else {
            textSpan.innerText = "‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô";
            textSpan.style.color = "#666";
        }
    }

    // --- Icon Picker Logic ---
    function updateIconPreview() {
        const val = document.getElementById('quickIconInput').value;
        const preview = document.getElementById('iconPreview');
        preview.innerHTML = val ? `<i class="${val}"></i>` : '';
    }

    function renderSuggestedIcons() {
        const commonIcons = [
            { class: 'far fa-clock', name: '‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤' }, { class: 'fas fa-phone-alt', name: '‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå' },
            { class: 'fas fa-envelope', name: '‡∏≠‡∏µ‡πÄ‡∏°‡∏•' }, { class: 'fas fa-map-marker-alt', name: '‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà' },
            { class: 'fas fa-book-open', name: '‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠' }, { class: 'fas fa-graduation-cap', name: '‡∏´‡∏°‡∏ß‡∏Å‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏¥‡∏ç‡∏ç‡∏≤' },
            { class: 'fas fa-user-graduate', name: '‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤' }, { class: 'fas fa-bullhorn', name: '‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®' },
            { class: 'fas fa-calendar-alt', name: '‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô' }, { class: 'fas fa-star', name: '‡∏î‡∏≤‡∏ß' },
            { class: 'fas fa-home', name: '‡∏ö‡πâ‡∏≤‡∏ô' }
        ];
        const container = document.getElementById('suggestedIcons');
        container.innerHTML = ''; 
        commonIcons.forEach(icon => {
            const btn = document.createElement('div');
            btn.className = 'icon-chip';
            btn.innerHTML = `<i class="${icon.class}"></i>`;
            btn.onclick = () => { document.getElementById('quickIconInput').value = icon.class; updateIconPreview(); };
            container.appendChild(btn);
        });
    }

    // --- Stats Logic ---
    function getLogs() { return JSON.parse(localStorage.getItem(LOG_KEY) || '[]'); }
    function loadStats() {
        const logs = getLogs();
        const now = new Date();
        const todayStr = now.toISOString().split('T')[0];
        const thisMonthStr = now.toISOString().slice(0, 7);
        
        document.getElementById('statToday').innerText = logs.filter(t => t.startsWith(todayStr)).length;
        document.getElementById('statMonth').innerText = logs.filter(t => t.startsWith(thisMonthStr)).length;
        document.getElementById('statTotal').innerText = logs.length;
        updateChart('daily');
    }

    function updateChart(type) {
        const logs = getLogs();
        const now = new Date();
        const ctx = document.getElementById('usageChart').getContext('2d');
        let labels = [], dataCounts = [], chartLabel = "";
        document.getElementById('btnDaily').className = type === 'daily' ? 'active' : '';
        document.getElementById('btnMonthly').className = type === 'monthly' ? 'active' : '';

        if (type === 'daily') {
            chartLabel = `‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ${now.getMonth()+1})`;
            const currentDay = now.getDate();
            for (let i = 1; i <= currentDay; i++) {
                labels.push(i);
                let check = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
                dataCounts.push(logs.filter(l => l.startsWith(check)).length);
            }
        } else {
            chartLabel = `‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏õ‡∏µ ${now.getFullYear()})`;
            const months = ["‡∏°.‡∏Ñ.", "‡∏Å.‡∏û.", "‡∏°‡∏µ.‡∏Ñ.", "‡πÄ‡∏°.‡∏¢.", "‡∏û.‡∏Ñ.", "‡∏°‡∏¥.‡∏¢.", "‡∏Å.‡∏Ñ.", "‡∏™.‡∏Ñ.", "‡∏Å.‡∏¢.", "‡∏ï.‡∏Ñ.", "‡∏û.‡∏¢.", "‡∏ò.‡∏Ñ."];
            for (let i = 0; i <= now.getMonth(); i++) {
                labels.push(months[i]);
                let check = `${now.getFullYear()}-${String(i+1).padStart(2,'0')}`;
                dataCounts.push(logs.filter(l => l.startsWith(check)).length);
            }
        }
        if (myChart) myChart.destroy();
        myChart = new Chart(ctx, {
            type: 'line',
            data: { labels, datasets: [{ label: '‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ä‡∏°', data: dataCounts, borderColor: '#bb0d0d', backgroundColor: 'rgba(187, 13, 13, 0.1)', borderWidth: 2, fill: true, tension: 0.3 }] },
            options: { responsive: true, scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }, plugins: { legend: { display: false }, title: { display: true, text: chartLabel } } }
        });
    }

    // --- Response & Quick Menu Logic ---
    const defaultData = [{ keywords: ["‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ"], response: "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö" }];
    const defaultQuick = [{ label: "‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏Å‡∏≤‡∏£", icon: "far fa-clock", message: "‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏Å‡∏≤‡∏£" }];

    function loadData() { return JSON.parse(localStorage.getItem('cicc_bot_data') || JSON.stringify(defaultData)); }
    function loadQuick() { return JSON.parse(localStorage.getItem(QUICK_KEY) || JSON.stringify(defaultQuick)); }

    function toggleQuickOption() {
        const isChecked = document.getElementById('addToQuickCheck').checked;
        const box = document.getElementById('quickOptionBox');
        if (isChecked) {
            box.classList.add('show');
            const kw = document.getElementById('keywordsInput').value.split(',')[0].trim();
            if(kw && !document.getElementById('quickLabelInput').value) document.getElementById('quickLabelInput').value = kw;
            updateIconPreview();
        } else box.classList.remove('show');
    }

    function renderTable() {
        const data = loadData();
        const tbody = document.getElementById('responseTable');
        tbody.innerHTML = '';
        data.forEach((item, index) => {
            tbody.innerHTML += `<tr><td>${item.keywords.map(k=>`<span class="keyword-tag">${k}</span>`).join('')}</td><td>${item.response}</td><td class="actions"><button class="btn-edit" onclick="editItem(${index})"><i class="fas fa-edit"></i></button> <button class="btn-delete" onclick="deleteItem(${index})"><i class="fas fa-trash"></i></button></td></tr>`;
        });
    }

    function renderQuickTable() {
        const data = loadQuick();
        const tbody = document.getElementById('quickTable');
        tbody.innerHTML = '';
        data.forEach((item, index) => {
            tbody.innerHTML += `<tr><td style="text-align:center; color:var(--primary-color)"><i class="${item.icon}"></i></td><td>${item.label}</td><td>${item.message}</td><td class="actions"><button class="btn-delete" onclick="deleteQuick(${index})"><i class="fas fa-trash"></i></button></td></tr>`;
        });
    }

    function saveResponse() {
        const k = document.getElementById('keywordsInput').value;
        const r = document.getElementById('responseInput').value;
        if(!k || !r) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏´‡∏•‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö");
        
        let data = loadData();
        const keywordsArr = k.split(',').map(s=>s.trim()).filter(x=>x);
        const obj = { keywords: keywordsArr, response: r };
        
        if(editIndex === -1) data.push(obj); else { data[editIndex] = obj; cancelEdit(); }
        localStorage.setItem('cicc_bot_data', JSON.stringify(data));

        if (document.getElementById('addToQuickCheck').checked) {
            const qLabel = document.getElementById('quickLabelInput').value;
            const qIcon = document.getElementById('quickIconInput').value;
            const qMsg = keywordsArr[0];
            if (qLabel) {
                let quickData = loadQuick();
                quickData.push({ label: qLabel, icon: qIcon, message: qMsg });
                localStorage.setItem(QUICK_KEY, JSON.stringify(quickData));
            }
        }
        document.getElementById('keywordsInput').value=''; 
        document.getElementById('responseInput').value='';
        document.getElementById('addToQuickCheck').checked = false;
        document.getElementById('quickLabelInput').value='';
        document.getElementById('quickOptionBox').classList.remove('show');
        renderTable();
        renderQuickTable();
    }

    function deleteItem(i) { if(confirm("‡∏•‡∏ö‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ô‡∏µ‡πâ?")) { let d=loadData(); d.splice(i,1); localStorage.setItem('cicc_bot_data',JSON.stringify(d)); renderTable(); } }
    function editItem(i) { 
        let d=loadData(); 
        document.getElementById('keywordsInput').value=d[i].keywords.join(','); 
        document.getElementById('responseInput').value=d[i].response;
        editIndex=i; 
        document.getElementById('saveBtn').innerHTML='<i class="fas fa-save"></i> ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï'; 
        document.getElementById('saveBtn').classList.add('editing'); 
        document.getElementById('cancelBtn').style.display='block';
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    function cancelEdit() {
        editIndex=-1; 
        document.getElementById('keywordsInput').value=''; 
        document.getElementById('responseInput').value='';
        document.getElementById('saveBtn').innerHTML='<i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'; 
        document.getElementById('saveBtn').classList.remove('editing'); 
        document.getElementById('cancelBtn').style.display='none';
    }
    function deleteQuick(i) {
        if(confirm("‡∏•‡∏ö‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π‡∏•‡∏±‡∏î‡∏ô‡∏µ‡πâ?")) {
            let d = loadQuick();
            d.splice(i, 1);
            localStorage.setItem(QUICK_KEY, JSON.stringify(d));
            renderQuickTable();
        }
    }
</script>

</body>
</html>