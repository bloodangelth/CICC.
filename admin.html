<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CICC Admin Panel</title>
    
    <link rel="stylesheet" href="style1.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ñ‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ */
        .editor-toolbar {
            display: flex;
            gap: 10px;
            margin-bottom: 5px;
            background: #f8f9fa;
            padding: 8px;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            flex-wrap: wrap;
        }
        .tool-btn {
            background: #fff;
            border: 1px solid #ccc;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 0.9rem;
            color: #333;
            transition: 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .tool-btn:hover {
            background: #e2e6ea;
            color: var(--primary-color);
        }
        /* ‡∏õ‡∏£‡∏±‡∏ö textarea ‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö toolbar */
        #responseInput {
            border-top-left-radius: 0;
            border-top-right-radius: 0;
            margin-top: 0;
        }
    </style>
</head>
<body>

<div id="loginOverlay">
    <div class="login-box">
        <h3><i class="fas fa-lock"></i> Admin Login</h3>
        <input type="password" id="adminPassword" placeholder="‡∏£‡∏´‡∏±‡∏™: 1234" style="width:100%; margin-bottom:10px; padding:10px;" onkeydown="if(event.key==='Enter') window.checkPassword()">
        <button class="btn-save" onclick="window.checkPassword()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>
</div>

<div class="container" id="mainContainer">
    <h2>
        <span><i class="fas fa-chart-line"></i> ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î & ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span>
        <a href="index.html" class="back-btn"><i class="fas fa-arrow-left"></i> ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ä‡∏ó</a>
    </h2>

    <div class="stats-grid">
        <div class="stat-card">
            <h4><i class="fas fa-calendar-day"></i> ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h4>
            <div class="number" id="statToday">...</div>
        </div>
        <div class="stat-card">
            <h4><i class="fas fa-calendar-alt"></i> ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</h4>
            <div class="number" id="statMonth">...</div>
        </div>
        <div class="stat-card">
            <h4><i class="fas fa-users"></i> ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h4>
            <div class="number" id="statTotal">...</div>
        </div>
    </div>

    <div class="chart-section">
        <div class="chart-header">
            <h4 id="chartTitle" style="margin:0">‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</h4>
            <div class="chart-toggles">
                <button id="btnDaily" class="active" onclick="window.updateChart('daily')">‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</button>
                <button id="btnMonthly" onclick="window.updateChart('monthly')">‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>
            </div>
        </div>
        <canvas id="usageChart" height="100"></canvas>
    </div>

    <h3 class="section-header"><i class="fas fa-bullhorn"></i> ‡πÅ‡∏ñ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° (Notification)</h3>
    <div class="notif-box">
        <div class="switch-label">
            <label class="switch">
                <input type="checkbox" id="notifActive">
                <span class="slider"></span>
            </label>
            <span id="notifStatusText">‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>
        </div>
        <div class="form-group" style="margin-bottom:0">
            <label>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:</label>
            <input type="text" id="notifMessage" placeholder="‡πÄ‡∏ä‡πà‡∏ô üì¢ ‡∏ß‡∏±‡∏ô‡∏®‡∏∏‡∏Å‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° Open House ‡∏á‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô">
        </div>
        <button class="btn-save" onclick="window.saveNotification()"><i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</button>
    </div>


    <h3 class="section-header"><i class="fas fa-robot"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö & ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π</h3>
    
    <div class="form-group">
        <input type="text" id="keywordsInput" placeholder="‡∏Ñ‡∏≥‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå (‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≥) ‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, ‡∏´‡∏ß‡∏±‡∏î‡∏î‡∏µ">
    </div>
    
    <div class="form-group">
        <div class="editor-toolbar">
            <input type="file" id="imageUploadHidden" accept="image/*" style="display: none;" onchange="window.handleImageUpload(this)">
            
            <button class="tool-btn" onclick="document.getElementById('imageUploadHidden').click()">
                <i class="fas fa-image"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å‡∏≠‡∏±‡∏•‡∏ö‡∏±‡πâ‡∏°
            </button>
            
            <button class="tool-btn" onclick="window.insertLinkTag()">
                <i class="fas fa-link"></i> ‡πÅ‡∏ó‡∏£‡∏Å‡∏•‡∏¥‡∏á‡∏Ñ‡πå
            </button>
            <button class="tool-btn" onclick="window.insertLineBreak()">
                <i class="fas fa-level-down-alt"></i> ‡πÄ‡∏ß‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î
            </button>
        </div>
        <textarea id="responseInput" placeholder="‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏ö‡∏≠‡∏ó..." style="height:120px"></textarea>
    </div>

    <label class="checkbox-wrapper">
        <input type="checkbox" id="addToQuickCheck" onchange="window.toggleQuickOption()"> 
        <span><i class="fas fa-plus-square"></i> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π‡∏•‡∏±‡∏î‡∏î‡πâ‡∏ß‡∏¢ (Quick Menu)</span>
    </label>

    <div id="quickOptionBox" class="quick-option-box">
        <div class="form-group">
            <label style="font-size:0.9rem;">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏ô‡∏õ‡∏∏‡πà‡∏°:</label>
            <input type="text" id="quickLabelInput" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏Å‡∏≤‡∏£">
        </div>
        <div class="form-group">
            <label style="font-size:0.9rem;">‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô:</label>
            <div class="icon-input-wrapper">
                <input type="text" id="quickIconInput" placeholder="‡πÄ‡∏ä‡πà‡∏ô far fa-clock" value="fas fa-comment-dots" oninput="window.updateIconPreview()">
                <div id="iconPreview" class="icon-preview"><i class="fas fa-comment-dots"></i></div>
            </div>
            <div class="suggested-icons" id="suggestedIcons"></div>
        </div>
    </div>

    <button class="btn-save" id="saveBtn" onclick="window.saveResponse()"><i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    <button class="btn-cancel" id="cancelBtn" onclick="window.cancelEdit()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>

    <h4 style="margin-top:20px; color:#666;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h4>
    <table>
        <thead><tr><th width="30%">‡∏Ñ‡∏≥‡∏´‡∏•‡∏±‡∏Å</th><th width="50%">‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</th><th width="20%">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
        <tbody id="responseTable"></tbody>
    </table>

    <h3 class="section-header"><i class="fas fa-th-large"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π‡∏•‡∏±‡∏î (Quick Menu)</h3>
    <table>
        <thead><tr><th width="10%">‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô</th><th width="30%">‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏∏‡πà‡∏°</th><th width="40%">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á</th><th width="20%">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
        <tbody id="quickTable"></tbody>
    </table>

</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue, push, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // --- ‡∏£‡∏´‡∏±‡∏™ Firebase ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ---
    const firebaseConfig = {
      apiKey: "AIzaSyBs-1OF_k_iUsydZF5DjLFRnv0fcTAJxiE",
      authDomain: "cicc-91f0b.firebaseapp.com",
      databaseURL: "https://cicc-91f0b-default-rtdb.firebaseio.com",
      projectId: "cicc-91f0b",
      storageBucket: "cicc-91f0b.firebasestorage.app",
      messagingSenderId: "596317132498",
      appId: "1:596317132498:web:e5c4bc56a55d26940e7f0b",
      measurementId: "G-GK5FB9CCRF"
    };

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    let botData = [];
    let quickData = [];
    let logs = [];
    let editIndex = -1;
    let myChart = null;
    const ADMIN_PASS = "1234";

    // --- Helper Functions ---
    
    function insertAtCursor(myValue) {
        const myField = document.getElementById('responseInput');
        if (myField.selectionStart || myField.selectionStart == '0') {
            var startPos = myField.selectionStart;
            var endPos = myField.selectionEnd;
            myField.value = myField.value.substring(0, startPos)
                + myValue
                + myField.value.substring(endPos, myField.value.length);
        } else {
            myField.value += myValue;
        }
        myField.focus();
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
    window.handleImageUpload = function(input) {
        if (input.files && input.files[0]) {
            const file = input.files[0];
            const reader = new FileReader();

            const originalPlaceholder = document.getElementById('responseInput').getAttribute('placeholder');
            document.getElementById('responseInput').setAttribute('placeholder', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...');

            reader.onload = function(e) {
                const img = new Image();
                img.src = e.target.result;
                
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    const maxWidth = 600;
                    let width = img.width;
                    let height = img.height;

                    if (width > maxWidth) {
                        height *= maxWidth / width;
                        width = maxWidth;
                    }

                    canvas.width = width;
                    canvas.height = height;
                    ctx.drawImage(img, 0, 0, width, height);

                    const dataUrl = canvas.toDataURL('image/jpeg', 0.7);

                    const html = `<br><img src="${dataUrl}" style="width:100%; border-radius:10px; margin-top:5px;"><br>`;
                    insertAtCursor(html);
                    
                    input.value = ''; 
                    document.getElementById('responseInput').setAttribute('placeholder', originalPlaceholder);
                };
            };
            reader.readAsDataURL(file);
        }
    }

    window.insertLinkTag = function() {
        const url = prompt("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏≤‡∏á URL ‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå:", "https://");
        if (url) {
            const text = prompt("‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏Ñ‡∏•‡∏¥‡∏Å:", "‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà");
            const html = ` <a href="${url}" target="_blank" style="color:#007bff; text-decoration:underline;">${text || '‡∏•‡∏¥‡∏á‡∏Ñ‡πå'}</a> `;
            insertAtCursor(html);
        }
    }
    
    window.insertLineBreak = function() {
        insertAtCursor("\n"); 
    }

    // --- Main Logic ---

    window.checkPassword = function() {
        if(document.getElementById('adminPassword').value === ADMIN_PASS) {
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('mainContainer').style.display = 'block';
            startListening(); 
            renderSuggestedIcons();
        } else alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î!");
    }

    function startListening() {
        onValue(ref(db, 'cicc_bot_data'), (snapshot) => {
            botData = snapshot.val() || [];
            renderTable();
        });
        onValue(ref(db, 'cicc_quick_btns'), (snapshot) => {
            quickData = snapshot.val() || [];
            renderQuickTable();
        });
        onValue(ref(db, 'cicc_visit_logs'), (snapshot) => {
            const data = snapshot.val();
            logs = data ? Object.values(data) : [];
            loadStats();
        });
        onValue(ref(db, 'cicc_notification'), (snapshot) => {
            const notif = snapshot.val() || {active: false, message: ""};
            document.getElementById('notifActive').checked = notif.active;
            document.getElementById('notifMessage').value = notif.message;
            updateNotifStatusText();
        });
    }

    window.saveNotification = function() {
        const isActive = document.getElementById('notifActive').checked;
        const message = document.getElementById('notifMessage').value.trim();
        if (isActive && !message) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô");
        set(ref(db, 'cicc_notification'), { active: isActive, message: message })
            .then(() => alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!"));
    }

    document.getElementById('notifActive').addEventListener('change', updateNotifStatusText);
    function updateNotifStatusText() {
        const isActive = document.getElementById('notifActive').checked;
        const textSpan = document.getElementById('notifStatusText');
        textSpan.innerText = isActive ? "‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ä‡∏ó)" : "‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô";
        textSpan.style.color = isActive ? "#28a745" : "#666";
    }

    window.saveResponse = function() {
        const k = document.getElementById('keywordsInput').value;
        const r = document.getElementById('responseInput').value.replace(/\n/g, "<br>");
        
        if(!k || !r) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
        
        const keywordsArr = k.split(',').map(s=>s.trim()).filter(x=>x);
        const obj = { keywords: keywordsArr, response: r };
        
        let newBotData = [...botData];
        if(editIndex === -1) newBotData.push(obj);
        else { newBotData[editIndex] = obj; window.cancelEdit(); }
        
        set(ref(db, 'cicc_bot_data'), newBotData);

        if (document.getElementById('addToQuickCheck').checked) {
            const qLabel = document.getElementById('quickLabelInput').value;
            const qIcon = document.getElementById('quickIconInput').value;
            const qMsg = keywordsArr[0];
            if (qLabel) {
                let newQuickData = [...quickData];
                newQuickData.push({ label: qLabel, icon: qIcon, message: qMsg });
                set(ref(db, 'cicc_quick_btns'), newQuickData);
            }
        }
        
        document.getElementById('keywordsInput').value=''; 
        document.getElementById('responseInput').value='';
        document.getElementById('addToQuickCheck').checked = false;
        document.getElementById('quickLabelInput').value='';
        document.getElementById('quickOptionBox').classList.remove('show');
    }

    window.editItem = function(i) {
        document.getElementById('keywordsInput').value = botData[i].keywords.join(', ');
        document.getElementById('responseInput').value = botData[i].response.replaceAll("<br>", "\n");
        
        editIndex = i;
        document.getElementById('saveBtn').innerHTML = '<i class="fas fa-save"></i> ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï';
        document.getElementById('saveBtn').classList.add('editing');
        document.getElementById('cancelBtn').style.display = 'block';
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    window.deleteItem = function(i) {
        if(confirm("‡∏•‡∏ö‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ô‡∏µ‡πâ?")) {
            let newData = [...botData];
            newData.splice(i, 1);
            set(ref(db, 'cicc_bot_data'), newData);
        }
    }

    window.cancelEdit = function() {
        editIndex = -1;
        document.getElementById('keywordsInput').value=''; 
        document.getElementById('responseInput').value='';
        document.getElementById('saveBtn').innerHTML='<i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
        document.getElementById('saveBtn').classList.remove('editing');
        document.getElementById('cancelBtn').style.display='none';
    }

    window.deleteQuick = function(i) {
        if(confirm("‡∏•‡∏ö‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π‡∏•‡∏±‡∏î‡∏ô‡∏µ‡πâ?")) {
            let newData = [...quickData];
            newData.splice(i, 1);
            set(ref(db, 'cicc_quick_btns'), newData);
        }
    }

    function renderTable() {
        const tbody = document.getElementById('responseTable');
        tbody.innerHTML = '';
        botData.forEach((item, index) => {
            let shortResp = item.response.replace(/<[^>]*>?/gm, '');
            if(shortResp.length > 50) shortResp = shortResp.substring(0, 50) + "...";
            
            tbody.innerHTML += `<tr><td>${item.keywords.join(', ')}</td><td>${shortResp}</td><td class="actions"><button class="btn-edit" onclick="window.editItem(${index})"><i class="fas fa-edit"></i></button> <button class="btn-delete" onclick="window.deleteItem(${index})"><i class="fas fa-trash"></i></button></td></tr>`;
        });
    }

    function renderQuickTable() {
        const tbody = document.getElementById('quickTable');
        tbody.innerHTML = '';
        quickData.forEach((item, index) => {
            tbody.innerHTML += `<tr><td style="text-align:center; color:var(--primary-color)"><i class="${item.icon}"></i></td><td>${item.label}</td><td>${item.message}</td><td class="actions"><button class="btn-delete" onclick="window.deleteQuick(${index})"><i class="fas fa-trash"></i></button></td></tr>`;
        });
    }

    function loadStats() {
        const now = new Date();
        const todayStr = now.toISOString().split('T')[0];
        const thisMonthStr = now.toISOString().slice(0, 7);
        
        document.getElementById('statToday').innerText = logs.filter(t => t.startsWith(todayStr)).length;
        document.getElementById('statMonth').innerText = logs.filter(t => t.startsWith(thisMonthStr)).length;
        document.getElementById('statTotal').innerText = logs.length;
        window.updateChart('daily');
    }

    window.updateChart = function(type) {
        const now = new Date();
        const ctx = document.getElementById('usageChart').getContext('2d');
        let labels = [], dataCounts = [], chartLabel = "";

        document.getElementById('btnDaily').className = type === 'daily' ? 'active' : '';
        document.getElementById('btnMonthly').className = type === 'monthly' ? 'active' : '';

        if (type === 'daily') {
            chartLabel = `‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ${now.getMonth()+1})`;
            const currentDay = now.getDate();
            for (let i = 1; i <= currentDay; i++) {
                labels.push(i);
                let check = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
                dataCounts.push(logs.filter(l => l.startsWith(check)).length);
            }
        } else {
            chartLabel = `‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏õ‡∏µ ${now.getFullYear()})`;
            const months = ["‡∏°.‡∏Ñ.", "‡∏Å.‡∏û.", "‡∏°‡∏µ.‡∏Ñ.", "‡πÄ‡∏°.‡∏¢.", "‡∏û.‡∏Ñ.", "‡∏°‡∏¥.‡∏¢.", "‡∏Å.‡∏Ñ.", "‡∏™.‡∏Ñ.", "‡∏Å.‡∏¢.", "‡∏ï.‡∏Ñ.", "‡∏û.‡∏¢.", "‡∏ò.‡∏Ñ."];
            for (let i = 0; i <= now.getMonth(); i++) {
                labels.push(months[i]);
                let check = `${now.getFullYear()}-${String(i+1).padStart(2,'0')}`;
                dataCounts.push(logs.filter(l => l.startsWith(check)).length);
            }
        }
        if (myChart) myChart.destroy();
        myChart = new Chart(ctx, {
            type: 'line',
            data: { labels, datasets: [{ label: '‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ä‡∏°', data: dataCounts, borderColor: '#bb0d0d', backgroundColor: 'rgba(187, 13, 13, 0.1)', borderWidth: 2, fill: true, tension: 0.3 }] },
            options: { responsive: true, scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }, plugins: { legend: { display: false }, title: { display: true, text: chartLabel } } }
        });
    }

    window.toggleQuickOption = function() {
        const isChecked = document.getElementById('addToQuickCheck').checked;
        const box = document.getElementById('quickOptionBox');
        if (isChecked) {
            box.classList.add('show');
            const kw = document.getElementById('keywordsInput').value.split(',')[0].trim();
            if(kw && !document.getElementById('quickLabelInput').value) document.getElementById('quickLabelInput').value = kw;
            window.updateIconPreview();
        } else box.classList.remove('show');
    }

    window.updateIconPreview = function() {
        const val = document.getElementById('quickIconInput').value;
        document.getElementById('iconPreview').innerHTML = val ? `<i class="${val}"></i>` : '';
    }

    window.renderSuggestedIcons = function() {
        const commonIcons = [
            { class: 'far fa-clock', name: '‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤' }, { class: 'fas fa-phone-
